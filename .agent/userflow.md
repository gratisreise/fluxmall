## [User Flow] 이커머스 MVP 주문 프로세스

유저플로우는 크게 **1) 탐색 및 인증**, **2) 주문 및 재고 선점**, **3) 결제 및 확정**의 3단계로 나뉩니다.

### 1단계: 탐색 및 인증 (Discovery & Auth)

비회원이 상품을 구경하다가 로그인을 통해 권한을 얻는 과정입니다.

1. **상품 목록/상세 조회:** 사용자가 상품 정보를 탐색합니다. (비회원 가능)
2. **구매 시도:** 상세 페이지에서 [구매하기] 버튼을 클릭합니다.
3. **세션 체크:** * **세션 있음:** 2단계(주문 생성)로 즉시 이동
    - **세션 없음:** 로그인 페이지로 리다이렉트
4. **로그인 수행:** 사용자가 정보를 입력하고 로그인에 성공하면 서버는 **Session ID(Cookie)**를 발급하고 다시 상품 상세 페이지로 보냅니다.

### 2단계: 주문 및 재고 선점 (Order & Inventory Pre-occupancy)

회원이 실제 상품을 확보하는 핵심 비즈니스 로직 구간입니다.

1. **주문 요청:** 회원이 수량을 선택하고 다시 [구매하기]를 클릭합니다.
2. **재고 확인 및 선점 (Server-side):**
    - **재고 충분:** DB 재고를 즉시 차감하고 '결제 대기' 상태의 주문 데이터를 생성합니다.
    - **재고 부족:** "재고가 부족합니다" 메시지와 함께 상세 페이지로 돌아갑니다.
3. **주문서 화면 진입:** 재고 선점에 성공하면 사용자는 결제 대기 중인 주문서 화면을 보게 됩니다.

### 3단계: 결제 및 확정 (Payment & Completion)

결제 결과에 따라 주문을 최종 처리하는 단계입니다.

1. **결제 실행:** 사용자가 주문서에서 [결제하기]를 클릭합니다.
2. **결제 처리 (Simulation):**
    - **결제 성공:** 주문 상태를 '결제 완료'로 업데이트하고 완료 페이지를 노출합니다.
    - **결제 실패/취소:** * 차감했던 재고를 다시 상품 테이블로 복구(Rollback)시킵니다.
        - 주문 상태를 '주문 취소'로 변경하고 오류 메시지를 노출합니다.
3. **최종 완료:** 사용자는 주문 내역 리스트에서 '결제 완료' 상태를 확인합니다.

---

## [PM의 개발 포인트 체크]

백엔드 개발 시 위 유저플로우에서 주의해야 할 핵심 포인트 3가지입니다.

- **원자성(Atomicity):** 2단계에서 '재고 차감'과 '주문 생성'은 반드시 하나의 트랜잭션으로 묶여야 합니다. 하나라도 실패하면 둘 다 취소되어야 합니다.
- **세션 보안:** 모든 주문 관련 액션 전에는 `request.getSession(false)`를 통해 유효한 세션인지 검증하는 인터셉터(Interceptor) 혹은 필터(Filter) 배치가 필요합니다.
- **고아 재고 방지:** 사용자가 2단계에서 재고만 선점하고 브라우저를 닫아버리는 경우를 대비한 '만료(Expiration) 정책'이 필요합니다.